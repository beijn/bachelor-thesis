#!/bin/bash
#SBATCH -J ipynb
#SBATCH -t 06:59:00
#SBATCH --ntasks=1
#SBATCH --mem=40G
#SBATCH --cpus-per-task=10
#SBATCH --partition=gpu
#SBATCH --gres=gpu:tesla:1
#SBATCH --mail-user=benjamin.eckhardt@ut.ee


FILE="$PWD/$1"
NAME="$(basename "$FILE" .ipynb)"
OUTDIR=results #/"$NAME"
ENV="$(basename "$(dirname "$FILE")")"


micromamba shell init --shell=bash --prefix=~/.micromamba   >/dev/null
eval "$(micromamba shell hook --shell=bash)"                >/dev/null
micromamba activate "$ENV"                                  >/dev/null


nvidia-smi


cd "$(dirname "$FILE")"

mkdir -p "$OUTDIR"


papermill "$FILE" "$OUTDIR/$(date +%y%m%d-%H%M%S).???.ipynb"
