#!/bin/bash
#SBATCH -J ipynb
#SBATCH -t 06:59:00
#SBATCH --ntasks=1
#SBATCH --mem=8G
#SBATCH --cpus-per-task=2
#SBATCH --partition=main
#SBATCH --mail-user=benjamin.eckhardt@ut.ee


FILE="$1"
NAME="$(basename "$FILE" .py)"
DIR="$(dirname "$FILE")"
ENV="$(basename "$(dirname "$FILE")")"
OUTDIR="~/thesis/runs/$ENV/$NAME"

cd "$DIR"


micromamba shell init --shell=bash --prefix=~/.micromamba   >/dev/null
eval "$(micromamba shell hook --shell=bash)"                >/dev/null
micromamba activate "$ENV"                                  >/dev/null


nvidia-smi


mkdir -p "$OUTDIR"

jupytext --to notebook --execute -o "$OUTDIR/$(date +%y%m%d-%H%M%S).ipynb" "$FILE"
